<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QUnit Test Suite</title>
    <link rel="stylesheet" href="https://code.jquery.com/qunit/qunit-2.24.1.css">
</head>
<body>
    <div id="qunit"></div>
    <div id="qunit-fixture"></div>

    <script src="https://code.jquery.com/qunit/qunit-2.24.1.js"></script>

    <!-- Source file(s) to be tested -->
    <script src="../numberFormatter.js"></script>
    <!-- Add other source files here as needed, e.g., ../generatorManager.js -->

    <!-- Test file(s) -->
    <script src="numberFormatter.test.js"></script>
    <!-- Add other test files here, e.g., generatorManager.test.js -->
    <!-- For now, numberFormatter.test.js is commented out as it will be created in the next step -->

    <script>
    QUnit.begin(function() {
        const toolbar = document.getElementById('qunit-testrunner-toolbar');
        if (!toolbar) {
            console.error('QUnit toolbar not found. Cannot add toggle all checkbox.');
            return;
        }

        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.id = 'qunit-toggle-all';
        checkbox.style.marginLeft = "1em";

        const label = document.createElement('label');
        label.htmlFor = 'qunit-toggle-all';
        label.textContent = 'Expand all tests';

        let optionsSpan = toolbar.querySelector('#qunit-options');
        if (optionsSpan) {
            optionsSpan.appendChild(checkbox);
            optionsSpan.appendChild(label);
        } else {
            toolbar.appendChild(checkbox);
            toolbar.appendChild(label);
            // console.warn('#qunit-options span not found. Appended toggle checkbox directly to toolbar.');
        }

        checkbox.addEventListener('change', function() {
            const testItems = document.querySelectorAll('#qunit-tests > li'); // CORRECTED SELECTOR
            if (this.checked) {
                testItems.forEach(function(testItem) {
                    const assertList = testItem.querySelector('ol.qunit-assert-list');
                    if (assertList) {
                        assertList.classList.remove('qunit-collapsed');
                    }
                    const sourcePara = testItem.querySelector('p.qunit-source');
                    if (sourcePara) {
                        sourcePara.classList.remove('qunit-collapsed');
                    }
                });
                label.textContent = 'Collapse all tests';
            } else {
                testItems.forEach(function(testItem) {
                    const assertList = testItem.querySelector('ol.qunit-assert-list');
                    if (assertList) {
                        assertList.classList.add('qunit-collapsed');
                    }
                    const sourcePara = testItem.querySelector('p.qunit-source');
                    if (sourcePara) {
                        sourcePara.classList.add('qunit-collapsed');
                    }
                });
                label.textContent = 'Expand all tests';
            }
        });
    });
    </script>
</body>
</html>
